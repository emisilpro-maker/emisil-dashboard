<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Emisil Nerve Center</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:     #0f1117;
  --card:   #1a1d27;
  --border: #2a2d3a;
  --text:   #e1e4ed;
  --muted:  #8b8fa3;
  --accent-blue:   #6366f1;
  --accent-green:  #22c55e;
  --accent-orange: #f59e0b;
  --accent-red:    #ef4444;
  --accent-cyan:   #06b6d4;
  --accent-purple: #a855f7;
  --up:     #22c55e;
  --down:   #ef4444;
  --radius: 12px;
}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
  background:var(--bg);color:var(--text);line-height:1.5;
  min-height:100vh;padding:16px;
}
a{color:var(--accent-blue);text-decoration:none}

/* ── HEADER ── */
.header{
  text-align:center;padding:24px 0 8px;margin-bottom:24px;
}
.header h1{
  font-size:clamp(1.5rem,4vw,2.2rem);font-weight:700;
  background:linear-gradient(135deg,var(--accent-blue),var(--accent-purple));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  background-clip:text;
}
.header .sub{color:var(--muted);font-size:.85rem;margin-top:4px}
.header .period{
  display:inline-block;margin-top:8px;padding:4px 14px;
  background:var(--card);border:1px solid var(--border);border-radius:20px;
  font-size:.8rem;color:var(--muted);
}

/* ── SECTION TITLES ── */
.section-title{
  display:flex;align-items:center;gap:10px;
  margin:32px 0 16px;font-size:1.1rem;font-weight:600;
}
.section-title .dot{
  width:10px;height:10px;border-radius:50%;flex-shrink:0;
}
.section-title .tag{
  margin-left:auto;font-size:.7rem;font-weight:400;
  padding:2px 10px;border-radius:10px;color:var(--muted);
  border:1px solid var(--border);
}

/* ── KPI CARDS GRID ── */
.kpi-grid{
  display:grid;gap:12px;
  grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
}
.kpi{
  background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
  padding:16px;position:relative;overflow:hidden;
}
.kpi .label{font-size:.75rem;color:var(--muted);text-transform:uppercase;letter-spacing:.5px}
.kpi .value{font-size:1.6rem;font-weight:700;margin:4px 0 2px}
.kpi .delta{font-size:.78rem;font-weight:500}
.kpi .delta.up{color:var(--up)}
.kpi .delta.down{color:var(--down)}
.kpi .delta.neutral{color:var(--muted)}
.kpi .spark{position:absolute;bottom:0;right:0;width:80px;height:36px;opacity:.5}
.kpi::before{
  content:'';position:absolute;top:0;left:0;right:0;height:3px;
}
.kpi.blue::before{background:var(--accent-blue)}
.kpi.green::before{background:var(--accent-green)}
.kpi.orange::before{background:var(--accent-orange)}
.kpi.cyan::before{background:var(--accent-cyan)}
.kpi.purple::before{background:var(--accent-purple)}
.kpi.red::before{background:var(--accent-red)}

/* ── CHARTS ── */
.chart-card{
  background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
  padding:16px;margin-bottom:12px;
}
.chart-card h3{font-size:.85rem;color:var(--muted);margin-bottom:12px;font-weight:500}
.chart-wrap{position:relative;width:100%;max-height:300px}
.chart-row{
  display:grid;gap:12px;
  grid-template-columns:1fr;
}
@media(min-width:768px){
  .chart-row{grid-template-columns:1fr 1fr}
  .chart-row.triple{grid-template-columns:1fr 1fr 1fr}
}

/* ── TABLES ── */
.table-card{
  background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
  padding:16px;overflow-x:auto;margin-bottom:12px;
}
.table-card h3{font-size:.85rem;color:var(--muted);margin-bottom:12px;font-weight:500}
table{width:100%;border-collapse:collapse;font-size:.82rem}
th{
  text-align:left;padding:8px 10px;color:var(--muted);font-weight:500;
  border-bottom:1px solid var(--border);font-size:.72rem;text-transform:uppercase;
  letter-spacing:.5px;white-space:nowrap;
}
td{padding:8px 10px;border-bottom:1px solid rgba(255,255,255,.04);white-space:nowrap}
tr:hover td{background:rgba(255,255,255,.02)}
.pos-badge{
  display:inline-block;padding:2px 8px;border-radius:6px;font-size:.72rem;font-weight:600;
  min-width:36px;text-align:center;
}
.pos-1{background:rgba(34,197,94,.15);color:#22c55e}
.pos-top5{background:rgba(99,102,241,.15);color:#818cf8}
.pos-top10{background:rgba(245,158,11,.15);color:#f59e0b}
.pos-low{background:rgba(239,68,68,.1);color:#f87171}

/* ── BAR INDICATORS ── */
.bar-bg{
  background:rgba(255,255,255,.06);border-radius:4px;height:6px;width:100%;position:relative;
}
.bar-fill{height:100%;border-radius:4px;transition:width .3s}
.bar-fill.blue{background:var(--accent-blue)}
.bar-fill.green{background:var(--accent-green)}
.bar-fill.orange{background:var(--accent-orange)}
.bar-fill.purple{background:var(--accent-purple)}

/* ── PAGE PATH ── */
.page-path{
  font-family:'SF Mono',SFMono-Regular,Consolas,monospace;
  font-size:.75rem;color:var(--accent-cyan);max-width:280px;
  overflow:hidden;text-overflow:ellipsis;
}

/* ── FOOTER ── */
.footer{
  text-align:center;padding:32px 0 16px;color:var(--muted);font-size:.75rem;
}

/* ── LOGIN OVERLAY ── */
#loginOverlay{
  position:fixed;inset:0;z-index:9999;
  background:var(--bg);
  display:flex;align-items:center;justify-content:center;
}
#loginOverlay.hidden{display:none}
.login-box{
  background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
  padding:40px 36px;width:100%;max-width:360px;text-align:center;
}
.login-box h2{
  font-size:1.4rem;font-weight:700;margin-bottom:4px;
  background:linear-gradient(135deg,var(--accent-blue),var(--accent-purple));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  background-clip:text;
}
.login-box .login-sub{color:var(--muted);font-size:.82rem;margin-bottom:24px}
.login-box input{
  width:100%;padding:10px 14px;
  background:var(--bg);border:1px solid var(--border);border-radius:8px;
  color:var(--text);font-size:.9rem;outline:none;
  transition:border-color .2s;
}
.login-box input:focus{border-color:var(--accent-blue)}
.login-box button{
  width:100%;margin-top:12px;padding:10px 0;
  background:var(--accent-blue);color:#fff;border:none;border-radius:8px;
  font-size:.9rem;font-weight:600;cursor:pointer;
  transition:opacity .2s;
}
.login-box button:hover{opacity:.85}
.login-error{
  color:var(--accent-red);font-size:.78rem;margin-top:10px;
  min-height:1.2em;
}
#dashboardContent{display:none}
#dashboardContent.visible{display:block}

/* ── WOW SUMMARY BAR ── */
.wow-bar{
  display:grid;gap:8px;margin-bottom:24px;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
}
.wow-item{
  background:var(--card);border:1px solid var(--border);border-radius:8px;
  padding:10px 12px;text-align:center;
}
.wow-item .metric{font-size:.65rem;color:var(--muted);text-transform:uppercase;letter-spacing:.3px}
.wow-item .val{font-size:1.1rem;font-weight:700;margin:2px 0}
.wow-item .chg{font-size:.72rem;font-weight:600}
.wow-item .chg.up{color:var(--up)}.wow-item .chg.down{color:var(--down)}

/* ── RESPONSIVE ── */
@media(max-width:480px){
  body{padding:10px}
  .kpi .value{font-size:1.3rem}
  .kpi-grid{grid-template-columns:repeat(2,1fr)}
  .wow-bar{grid-template-columns:repeat(2,1fr)}
  table{font-size:.75rem}
  td,th{padding:6px 6px}
}
</style>
</head>
<body>

<div id="loginOverlay">
  <div class="login-box">
    <h2>Emisil Nerve Center</h2>
    <div class="login-sub">Enter password to view the dashboard</div>
    <input type="password" id="loginPassword" placeholder="Password" autofocus>
    <button id="loginBtn">Sign In</button>
    <div class="login-error" id="loginError"></div>
  </div>
</div>

<div id="dashboardContent">

<div class="header">
  <h1>Emisil Nerve Center</h1>
  <div class="sub">Weekly Performance Dashboard</div>
  <div class="period">Feb 20 &ndash; Feb 27, 2026 &nbsp;&middot;&nbsp; Updated Feb 27</div>
</div>

<!-- ════════════════════════ WOW SUMMARY ════════════════════════ -->
<div class="wow-bar" id="wowBar"></div>

<!-- ════════════════════════ GA4 ════════════════════════ -->
<div class="section-title">
  <span class="dot" style="background:var(--accent-blue)"></span>
  Google Analytics
  <span class="tag">GA4 Property 298001572</span>
</div>

<div class="kpi-grid" id="ga4Kpis"></div>

<div class="chart-row" style="margin-top:12px">
  <div class="chart-card">
    <h3>Sessions &amp; Users (Daily)</h3>
    <div class="chart-wrap"><canvas id="ga4DailyChart"></canvas></div>
  </div>
  <div class="chart-card">
    <h3>Pageviews &amp; Bounce Rate (Daily)</h3>
    <div class="chart-wrap"><canvas id="ga4PvBounceChart"></canvas></div>
  </div>
</div>

<div class="table-card">
  <h3>Top 10 Pages by Pageviews</h3>
  <table id="topPagesTable"></table>
</div>

<!-- ════════════════════════ SHOPIFY ════════════════════════ -->
<div class="section-title">
  <span class="dot" style="background:var(--accent-green)"></span>
  Shopify
  <span class="tag">emisil.com</span>
</div>

<div class="kpi-grid" id="shopifyKpis"></div>

<div class="chart-row" style="margin-top:12px">
  <div class="chart-card">
    <h3>Revenue by Day</h3>
    <div class="chart-wrap"><canvas id="shopifyRevenueChart"></canvas></div>
  </div>
  <div class="chart-card">
    <h3>Orders by Country</h3>
    <div class="chart-wrap"><canvas id="shopifyCountryChart"></canvas></div>
  </div>
</div>

<div class="table-card">
  <h3>Top 10 Products by Revenue</h3>
  <table id="topProductsTable"></table>
</div>

<!-- ════════════════════════ GSC ════════════════════════ -->
<div class="section-title">
  <span class="dot" style="background:var(--accent-orange)"></span>
  Google Search Console
  <span class="tag">sc-domain:emisil.com</span>
</div>

<div class="kpi-grid" id="gscKpis"></div>

<div class="chart-row" style="margin-top:12px">
  <div class="chart-card">
    <h3>Top Keywords &mdash; Clicks vs Impressions</h3>
    <div class="chart-wrap"><canvas id="gscKeywordsChart"></canvas></div>
  </div>
  <div class="chart-card">
    <h3>Keyword Positions</h3>
    <div class="chart-wrap"><canvas id="gscPositionChart"></canvas></div>
  </div>
</div>

<div class="table-card">
  <h3>Top 20 Keywords</h3>
  <table id="gscTable"></table>
</div>

<!-- ════════════════════════ SEO PERFORMANCE ════════════════════════ -->
<div class="section-title">
  <span class="dot" style="background:var(--accent-purple)"></span>
  SEO Performance
  <span class="tag">30-Day Report</span>
</div>

<div class="kpi-grid" id="seoKpis"></div>

<div class="table-card" style="margin-top:12px">
  <h3>Top 10 Blog Posts by Organic Clicks (30 days)</h3>
  <table id="seoBlogTable"></table>
</div>

<div class="table-card">
  <h3>Top 10 Search Queries (30 days)</h3>
  <table id="seoQueryTable"></table>
</div>

<div class="table-card">
  <h3>Position Change Alerts (&gt;3 positions shift)</h3>
  <div id="positionAlerts"></div>
</div>

<div class="footer">
  Emisil Nerve Center &middot; Data sources: GA4, Shopify, Google Search Console &middot; Auto-generated
</div>

</div><!-- end #dashboardContent -->

<script>
// ═══════════════════════════════════════════════════════════════
// AUTH GATE
// ═══════════════════════════════════════════════════════════════
(function(){
  const PASS_HASH = '9a1b22f7';
  function simpleHash(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0;}return(h>>>0).toString(16).slice(0,8)}

  function unlock(){
    document.getElementById('loginOverlay').classList.add('hidden');
    document.getElementById('dashboardContent').classList.add('visible');
    sessionStorage.setItem('nc_auth','1');
  }

  if(sessionStorage.getItem('nc_auth')==='1'){
    unlock();
  } else {
    var pwd=document.getElementById('loginPassword');
    var btn=document.getElementById('loginBtn');
    var err=document.getElementById('loginError');
    function attempt(){
      if(simpleHash(pwd.value)===PASS_HASH){
        unlock();
      } else {
        err.textContent='Incorrect password';
        pwd.value='';
        pwd.focus();
      }
    }
    btn.addEventListener('click',attempt);
    pwd.addEventListener('keydown',function(e){if(e.key==='Enter')attempt();});
  }
})();
// ═══════════════════════════════════════════════════════════════
// EMBEDDED DATA
// ═══════════════════════════════════════════════════════════════
const ga4 = {
  "overview": {
    "sessions": 15112,
    "users": 12791,
    "pageviews": 60738,
    "bounceRate": 0.24146373742721017
  },
  "daily": [
    {
      "date": "20260219",
      "sessions": 2047,
      "users": 1884,
      "pageviews": 6060,
      "bounceRate": 0.2887151929653151
    },
    {
      "date": "20260220",
      "sessions": 1918,
      "users": 1697,
      "pageviews": 7081,
      "bounceRate": 0.23357664233576642
    },
    {
      "date": "20260221",
      "sessions": 1815,
      "users": 1612,
      "pageviews": 7631,
      "bounceRate": 0.23911845730027548
    },
    {
      "date": "20260222",
      "sessions": 1717,
      "users": 1544,
      "pageviews": 8084,
      "bounceRate": 0.22655794991263833
    },
    {
      "date": "20260223",
      "sessions": 1723,
      "users": 1522,
      "pageviews": 7560,
      "bounceRate": 0.2420197330237957
    },
    {
      "date": "20260224",
      "sessions": 2060,
      "users": 1826,
      "pageviews": 8935,
      "bounceRate": 0.22427184466019418
    },
    {
      "date": "20260225",
      "sessions": 1996,
      "users": 1733,
      "pageviews": 8670,
      "bounceRate": 0.2219438877755511
    },
    {
      "date": "20260226",
      "sessions": 1795,
      "users": 1554,
      "pageviews": 6717,
      "bounceRate": 0.2545961002785515
    }
  ],
  "topPages": [
    {
      "pagePath": "/",
      "pageviews": 5528,
      "sessions": 4401,
      "users": 3970,
      "bounceRate": 0.11520109066121335
    },
    {
      "pagePath": "/collections/ftm-pack-and-play",
      "pageviews": 3659,
      "sessions": 2690,
      "users": 2430,
      "bounceRate": 0.053531598513011154
    },
    {
      "pagePath": "/collections/ftm-packers",
      "pageviews": 2759,
      "sessions": 2054,
      "users": 1918,
      "bounceRate": 0.0759493670886076
    },
    {
      "pagePath": "/products/pack-and-play-packer-ftm-er07",
      "pageviews": 2515,
      "sessions": 793,
      "users": 708,
      "bounceRate": 0.034047919293820936
    },
    {
      "pagePath": "/collections/ftm-stp",
      "pageviews": 2289,
      "sessions": 1761,
      "users": 1617,
      "bounceRate": 0.1033503691084611
    },
    {
      "pagePath": "/products/ftm-uncut-packer-fl11",
      "pageviews": 2158,
      "sessions": 635,
      "users": 554,
      "bounceRate": 0.09921259842519685
    },
    {
      "pagePath": "/products/4-in-1-packer",
      "pageviews": 2047,
      "sessions": 783,
      "users": 709,
      "bounceRate": 0.04853128991060025
    },
    {
      "pagePath": "/products/ftm-pack-and-play-packer-er01",
      "pageviews": 1983,
      "sessions": 956,
      "users": 899,
      "bounceRate": 0.12447698744769875
    },
    {
      "pagePath": "/products/ftm-pack-and-play-ftm-packer-er04",
      "pageviews": 1901,
      "sessions": 742,
      "users": 677,
      "bounceRate": 0.05929919137466307
    },
    {
      "pagePath": "/products/ftm-packer-trans-fl02",
      "pageviews": 1880,
      "sessions": 668,
      "users": 601,
      "bounceRate": 0.10778443113772455
    }
  ]
};

const ga4Prev = {
  "overview": {
    "sessions": 12701,
    "users": 10715,
    "pageviews": 50508,
    "bounceRate": 0.25840485001181007
  },
  "daily": [
    {
      "date": "20260212",
      "sessions": 2282
    },
    {
      "date": "20260213",
      "sessions": 1593
    },
    {
      "date": "20260214",
      "sessions": 1508
    },
    {
      "date": "20260215",
      "sessions": 1649
    },
    {
      "date": "20260216",
      "sessions": 1640
    },
    {
      "date": "20260217",
      "sessions": 1815
    },
    {
      "date": "20260218",
      "sessions": 2224
    }
  ],
  "topPages": [
    {
      "pagePath": "/",
      "pageviews": 4598
    },
    {
      "pagePath": "/collections/ftm-pack-and-play",
      "pageviews": 3317
    },
    {
      "pagePath": "/collections/ftm-packers",
      "pageviews": 2746
    },
    {
      "pagePath": "/collections/ftm-stp",
      "pageviews": 2236
    },
    {
      "pagePath": "/products/ftm-uncut-packer-fl11",
      "pageviews": 2000
    },
    {
      "pagePath": "/products/ftm-pack-and-play-ftm-packer-er04",
      "pageviews": 1827
    },
    {
      "pagePath": "/products/ftm-pack-and-play-er05",
      "pageviews": 1790
    },
    {
      "pagePath": "/products/ftm-packer-trans-fl02",
      "pageviews": 1740
    },
    {
      "pagePath": "/products/ftm-stp-3-in-1-stand-to-pee-device-2nd-gen",
      "pageviews": 1609
    },
    {
      "pagePath": "/products/ftm-pack-and-play-packer-er01",
      "pageviews": 1453
    }
  ]
};

const shopify = {
  "summary": {
    "totalOrders": 29,
    "totalRevenue": 14040.37,
    "averageOrderValue": 484.15,
    "paidOrders": 27,
    "pendingOrders": 1
  },
  "revenueByDay": [
    {
      "date": "2026-02-19",
      "orders": 1,
      "revenue": 514.25
    },
    {
      "date": "2026-02-20",
      "orders": 3,
      "revenue": 988.44
    },
    {
      "date": "2026-02-21",
      "orders": 2,
      "revenue": 660.26
    },
    {
      "date": "2026-02-22",
      "orders": 4,
      "revenue": 3149.35
    },
    {
      "date": "2026-02-24",
      "orders": 6,
      "revenue": 2760.11
    },
    {
      "date": "2026-02-25",
      "orders": 9,
      "revenue": 3920.72
    },
    {
      "date": "2026-02-26",
      "orders": 4,
      "revenue": 2047.24
    }
  ],
  "topProducts": [
    {
      "product": "3rd Gen STP Packer (Cut / Circumcised) – Discreet Pack & Pee",
      "units": 4,
      "revenue": 1930
    },
    {
      "product": "ER08 | Artist Edition P&P Model",
      "units": 3,
      "revenue": 1566
    },
    {
      "product": "3-in-1 STP Packer (FTM) – Pack, Pee & Play (2nd Gen Magic Mike)",
      "units": 3,
      "revenue": 1327
    },
    {
      "product": "ER05 | Bold Hyper-Realistic P&P Model",
      "units": 3,
      "revenue": 1244
    },
    {
      "product": "ER11 | Large Realistic FTM P&P Model",
      "units": 2,
      "revenue": 919
    },
    {
      "product": "ER06 | Large Realistic FTM P&P Model",
      "units": 2,
      "revenue": 902
    },
    {
      "product": "ER07 | Large Realistic FTM P&P Model",
      "units": 2,
      "revenue": 829
    },
    {
      "product": "ER04 | Versatile FTM P&P Model",
      "units": 2,
      "revenue": 769
    },
    {
      "product": "ER03 | Large Realistic FTM P&P Model | Silicone Form",
      "units": 1,
      "revenue": 656
    },
    {
      "product": "3rd Gen STP (Uncut) | Realistic FTM Silicone Model",
      "units": 1,
      "revenue": 595
    }
  ],
  "countries": [
    {
      "country": "US",
      "orders": 11,
      "share": 37.9
    },
    {
      "country": "DE",
      "orders": 4,
      "share": 13.8
    },
    {
      "country": "GB",
      "orders": 3,
      "share": 10.3
    },
    {
      "country": "CA",
      "orders": 2,
      "share": 6.9
    },
    {
      "country": "NL",
      "orders": 2,
      "share": 6.9
    },
    {
      "country": "IT",
      "orders": 1,
      "share": 3.4
    },
    {
      "country": "Other (6)",
      "orders": 6,
      "share": 20.7
    }
  ]
};

const shopifyPrev = {"summary":{"totalOrders":35,"totalRevenue":16495.16,"averageOrderValue":471.29}};

const gsc = {
  "totals": {
    "clicks": 874,
    "impressions": 7753
  },
  "keywords": [
    {
      "keyword": "emisil",
      "clicks": 352,
      "impressions": 489,
      "ctr": 71.98,
      "position": 1.38
    },
    {
      "keyword": "ftm packer",
      "clicks": 84,
      "impressions": 2534,
      "ctr": 3.31,
      "position": 7.87
    },
    {
      "keyword": "emisil prosthetics",
      "clicks": 76,
      "impressions": 87,
      "ctr": 87.36,
      "position": 1
    },
    {
      "keyword": "prosthetic penis",
      "clicks": 42,
      "impressions": 579,
      "ctr": 7.25,
      "position": 5
    },
    {
      "keyword": "ftm sex toys",
      "clicks": 33,
      "impressions": 262,
      "ctr": 12.6,
      "position": 4.89
    },
    {
      "keyword": "packer ftm",
      "clicks": 29,
      "impressions": 620,
      "ctr": 4.68,
      "position": 8.04
    },
    {
      "keyword": "ftm prosthetic",
      "clicks": 27,
      "impressions": 150,
      "ctr": 18,
      "position": 3.65
    },
    {
      "keyword": "ftm packers",
      "clicks": 25,
      "impressions": 402,
      "ctr": 6.22,
      "position": 7.8
    },
    {
      "keyword": "emisil stp",
      "clicks": 23,
      "impressions": 33,
      "ctr": 69.7,
      "position": 1
    },
    {
      "keyword": "ftm prosthetics",
      "clicks": 23,
      "impressions": 115,
      "ctr": 20,
      "position": 3.29
    },
    {
      "keyword": "ftm pack and play",
      "clicks": 22,
      "impressions": 250,
      "ctr": 8.8,
      "position": 9.17
    },
    {
      "keyword": "packers ftm",
      "clicks": 20,
      "impressions": 249,
      "ctr": 8.03,
      "position": 7.35
    },
    {
      "keyword": "ftm bottom growth",
      "clicks": 17,
      "impressions": 604,
      "ctr": 2.81,
      "position": 6.07
    },
    {
      "keyword": "ftm bottom growth stages",
      "clicks": 16,
      "impressions": 118,
      "ctr": 13.56,
      "position": 2.99
    },
    {
      "keyword": "ftm prosthesis",
      "clicks": 15,
      "impressions": 72,
      "ctr": 20.83,
      "position": 1.6
    },
    {
      "keyword": "ftm stp",
      "clicks": 15,
      "impressions": 184,
      "ctr": 8.15,
      "position": 7.9
    },
    {
      "keyword": "realistic penis sleeve",
      "clicks": 15,
      "impressions": 145,
      "ctr": 10.34,
      "position": 12.06
    },
    {
      "keyword": "t dick",
      "clicks": 15,
      "impressions": 714,
      "ctr": 2.1,
      "position": 4.43
    },
    {
      "keyword": "pack and play ftm",
      "clicks": 13,
      "impressions": 133,
      "ctr": 9.77,
      "position": 6.05
    },
    {
      "keyword": "emisil ftm",
      "clicks": 12,
      "impressions": 13,
      "ctr": 92.31,
      "position": 1
    }
  ]
};

const gscPrev = {"totals":{"clicks":858,"impressions":5456}};

const seo = {
  "current": {
    "clicks": 14112,
    "impressions": 319908,
    "ctr": 4.41,
    "position": 7.39
  },
  "previous": {
    "clicks": 14606,
    "impressions": 319479,
    "ctr": 4.57,
    "position": 7.79
  },
  "topQueries": [
    {
      "query": "emisil",
      "clicks": 1560,
      "impressions": 2093,
      "ctr": 74.53,
      "position": 1.18
    },
    {
      "query": "emisil prosthetics",
      "clicks": 310,
      "impressions": 377,
      "ctr": 82.23,
      "position": 1
    },
    {
      "query": "ftm packer",
      "clicks": 272,
      "impressions": 6103,
      "ctr": 4.46,
      "position": 8.21
    },
    {
      "query": "prosthetic penis",
      "clicks": 146,
      "impressions": 3182,
      "ctr": 4.59,
      "position": 6.09
    },
    {
      "query": "ftm sex toys",
      "clicks": 133,
      "impressions": 1128,
      "ctr": 11.79,
      "position": 5.32
    },
    {
      "query": "packer ftm",
      "clicks": 115,
      "impressions": 1831,
      "ctr": 6.28,
      "position": 8.88
    },
    {
      "query": "ftm packers",
      "clicks": 106,
      "impressions": 1518,
      "ctr": 6.98,
      "position": 8.84
    },
    {
      "query": "emisil stp",
      "clicks": 93,
      "impressions": 123,
      "ctr": 75.61,
      "position": 1
    },
    {
      "query": "ftm stp",
      "clicks": 85,
      "impressions": 703,
      "ctr": 12.09,
      "position": 7.67
    },
    {
      "query": "ftm bottom growth",
      "clicks": 79,
      "impressions": 2378,
      "ctr": 3.32,
      "position": 5.21
    }
  ],
  "topBlogPosts": [
    {
      "url": "/blogs/all-blog-posts/do-females-transitioning-to-male-get-a-penis",
      "clicks": 1138,
      "impressions": 88973,
      "ctr": 1.28,
      "position": 6.85,
      "prevClicks": 543,
      "prevPos": 7.51
    },
    {
      "url": "/blogs/all-blog-posts/ftm-sex-toys",
      "clicks": 788,
      "impressions": 11714,
      "ctr": 6.73,
      "position": 7.34,
      "prevClicks": 465,
      "prevPos": 8.44
    },
    {
      "url": "/blogs/all-blog-posts/best-stp-packers",
      "clicks": 627,
      "impressions": 9982,
      "ctr": 6.28,
      "position": 7.01,
      "prevClicks": 568,
      "prevPos": 7.23
    },
    {
      "url": "/blogs/all-blog-posts/ftm-fashion-guide-and-tips",
      "clicks": 417,
      "impressions": 19032,
      "ctr": 2.19,
      "position": 7.17,
      "prevClicks": 407,
      "prevPos": 8.21
    },
    {
      "url": "/blogs/all-blog-posts/how-to-wear-a-packer-positioning-comfort-top-ftm-packing-tips",
      "clicks": 370,
      "impressions": 13255,
      "ctr": 2.79,
      "position": 9.34,
      "prevClicks": 243,
      "prevPos": 11.22
    },
    {
      "url": "/blogs/all-blog-posts/ftm-adhesive-guide",
      "clicks": 307,
      "impressions": 3861,
      "ctr": 7.95,
      "position": 6.18,
      "prevClicks": 219,
      "prevPos": 6.38
    },
    {
      "url": "/blogs/all-blog-posts/ftm-packers-review",
      "clicks": 239,
      "impressions": 5686,
      "ctr": 4.2,
      "position": 7.46,
      "prevClicks": 338,
      "prevPos": 7.86
    },
    {
      "url": "/blogs/all-blog-posts/blogs-all-blog-posts-ftm-passing-pre-t-how-to-start-transitioning-now-emisil-blog",
      "clicks": 118,
      "impressions": 7435,
      "ctr": 1.59,
      "position": 8.6,
      "prevClicks": 40,
      "prevPos": 11
    },
    {
      "url": "/blogs/all-blog-posts/ftm-bottom-dysphoria-how-to-deal-alleviate-and-feel-supported-html-how-to-deal-with-dysphoria",
      "clicks": 105,
      "impressions": 7348,
      "ctr": 1.43,
      "position": 5.59,
      "prevClicks": 149,
      "prevPos": 5.79
    },
    {
      "url": "/blogs/all-blog-posts/how-to-make-an-ftm-packer-diy-packer",
      "clicks": 101,
      "impressions": 3518,
      "ctr": 2.87,
      "position": 7.58,
      "prevClicks": 150,
      "prevPos": 7.18
    }
  ],
  "positionAlerts": {
    "dropped": [
      {
        "page": "/collections/penis-sleeves",
        "prevPos": 9,
        "curPos": 18.09,
        "change": 9.09,
        "curClicks": 329
      },
      {
        "page": "/products/big-pack-and-play-ftm-packer-er12",
        "prevPos": 6.76,
        "curPos": 13.54,
        "change": 6.78,
        "curClicks": 7
      },
      {
        "page": "/products/realistic-stand-to-pee-packer-device-1st-gen",
        "prevPos": 5.86,
        "curPos": 12.34,
        "change": 6.48,
        "curClicks": 2
      },
      {
        "page": "/products/emisil-3rd-gen-uncircumcised-packer",
        "prevPos": 5.96,
        "curPos": 10.69,
        "change": 4.73,
        "curClicks": 24
      },
      {
        "page": "/products/emisil-penis-extension",
        "prevPos": 8.98,
        "curPos": 13.63,
        "change": 4.65,
        "curClicks": 8
      }
    ],
    "improved": [
      {
        "page": "/products/soft-ftm-packer-fl01",
        "prevPos": 23.54,
        "curPos": 7.54,
        "change": -16,
        "curClicks": 3
      },
      {
        "page": "/blogs/all-blog-posts/homemade-packing-underwear-ftm",
        "prevPos": 22.55,
        "curPos": 12.25,
        "change": -10.3,
        "curClicks": 83
      },
      {
        "page": "/products/brief-harness-black-red",
        "prevPos": 19.38,
        "curPos": 10.98,
        "change": -8.4,
        "curClicks": 8
      },
      {
        "page": "/products/rod-for-s-t-p-2nd-gen-smaller-version",
        "prevPos": 14.75,
        "curPos": 7.64,
        "change": -7.11,
        "curClicks": 2
      },
      {
        "page": "/products/stand-to-pee-realistic-stp-ftm-pee-1st-gen",
        "prevPos": 17.76,
        "curPos": 14.16,
        "change": -3.6,
        "curClicks": 4
      }
    ]
  }
};
// ═══════════════════════════════════════════════════════════════
// HELPERS
// ═══════════════════════════════════════════════════════════════
const fmt = n => n.toLocaleString('en-US');
const fmtE = n => '\u20AC' + n.toLocaleString('en-US',{minimumFractionDigits:0,maximumFractionDigits:0});
const pct = (c,p) => p===0?'+\u221E':((c-p)/p*100).toFixed(1);
const pctStr = (c,p) => {const v=pct(c,p);return (v>=0?'+':'')+v+'%'};
const deltaClass = (c,p,inv) => {
  const d=c-p; if(d===0)return'neutral';
  return inv?(d>0?'down':'up'):(d>0?'up':'down');
};
const dayLabel = s => {
  const m=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  if(s.length===8) return m[parseInt(s.slice(4,6))-1]+' '+parseInt(s.slice(6));
  return m[parseInt(s.slice(5,7))-1]+' '+parseInt(s.slice(8));
};
const shortDay = s => {
  const days=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  if(s.length===8) {
    const d=new Date(s.slice(0,4)+'-'+s.slice(4,6)+'-'+s.slice(6));
    return days[d.getUTCDay()];
  }
  return days[new Date(s).getUTCDay()];
};

// ═══════════════════════════════════════════════════════════════
// CHART DEFAULTS
// ═══════════════════════════════════════════════════════════════
Chart.defaults.color = '#8b8fa3';
Chart.defaults.borderColor = 'rgba(255,255,255,.06)';
Chart.defaults.font.family = "-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif";
Chart.defaults.font.size = 11;
Chart.defaults.plugins.legend.labels.boxWidth = 10;
Chart.defaults.plugins.legend.labels.padding = 14;
Chart.defaults.plugins.tooltip.backgroundColor = '#1a1d27';
Chart.defaults.plugins.tooltip.borderColor = '#2a2d3a';
Chart.defaults.plugins.tooltip.borderWidth = 1;
Chart.defaults.plugins.tooltip.padding = 10;
Chart.defaults.plugins.tooltip.cornerRadius = 8;

// ═══════════════════════════════════════════════════════════════
// WOW SUMMARY BAR
// ═══════════════════════════════════════════════════════════════
const wowData = [
  {m:'Sessions',v:fmt(ga4.overview.sessions),c:pctStr(ga4.overview.sessions,ga4Prev.overview.sessions),cls:deltaClass(ga4.overview.sessions,ga4Prev.overview.sessions)},
  {m:'Users',v:fmt(ga4.overview.users),c:pctStr(ga4.overview.users,ga4Prev.overview.users),cls:deltaClass(ga4.overview.users,ga4Prev.overview.users)},
  {m:'Revenue',v:fmtE(shopify.summary.totalRevenue),c:pctStr(shopify.summary.totalRevenue,shopifyPrev.summary.totalRevenue),cls:deltaClass(shopify.summary.totalRevenue,shopifyPrev.summary.totalRevenue)},
  {m:'Orders',v:shopify.summary.totalOrders,c:pctStr(shopify.summary.totalOrders,shopifyPrev.summary.totalOrders),cls:deltaClass(shopify.summary.totalOrders,shopifyPrev.summary.totalOrders)},
  {m:'AOV',v:fmtE(shopify.summary.averageOrderValue),c:pctStr(shopify.summary.averageOrderValue,shopifyPrev.summary.averageOrderValue),cls:deltaClass(shopify.summary.averageOrderValue,shopifyPrev.summary.averageOrderValue)},
  {m:'Bounce Rate',v:(ga4.overview.bounceRate*100).toFixed(1)+'%',c:(((ga4.overview.bounceRate-ga4Prev.overview.bounceRate)*100).toFixed(1))+'pp',cls:deltaClass(ga4.overview.bounceRate,ga4Prev.overview.bounceRate,true)},
];
document.getElementById('wowBar').innerHTML = wowData.map(d=>
  `<div class="wow-item"><div class="metric">${d.m}</div><div class="val">${d.v}</div><div class="chg ${d.cls}">${d.c}</div></div>`
).join('');

// ═══════════════════════════════════════════════════════════════
// GA4 KPIs
// ═══════════════════════════════════════════════════════════════
const ga4Kpis = [
  {label:'Sessions',value:fmt(ga4.overview.sessions),delta:pctStr(ga4.overview.sessions,ga4Prev.overview.sessions),cls:deltaClass(ga4.overview.sessions,ga4Prev.overview.sessions),c:'blue'},
  {label:'Users',value:fmt(ga4.overview.users),delta:pctStr(ga4.overview.users,ga4Prev.overview.users),cls:deltaClass(ga4.overview.users,ga4Prev.overview.users),c:'purple'},
  {label:'Pageviews',value:fmt(ga4.overview.pageviews),delta:pctStr(ga4.overview.pageviews,ga4Prev.overview.pageviews),cls:deltaClass(ga4.overview.pageviews,ga4Prev.overview.pageviews),c:'cyan'},
  {label:'Bounce Rate',value:(ga4.overview.bounceRate*100).toFixed(1)+'%',delta:(((ga4.overview.bounceRate-ga4Prev.overview.bounceRate)*100).toFixed(1))+'pp',cls:deltaClass(ga4.overview.bounceRate,ga4Prev.overview.bounceRate,true),c:'orange'},
  {label:'Pages/Session',value:(ga4.overview.pageviews/ga4.overview.sessions).toFixed(2),delta:'vs '+(ga4Prev.overview.pageviews/ga4Prev.overview.sessions).toFixed(2),cls:'neutral',c:'green'},
  {label:'Avg Daily Sessions',value:fmt(Math.round(ga4.daily.slice(0,7).reduce((s,d)=>s+d.sessions,0)/7)),delta:'excl. partial Feb 11',cls:'neutral',c:'blue'},
];
document.getElementById('ga4Kpis').innerHTML = ga4Kpis.map(k=>
  `<div class="kpi ${k.c}"><div class="label">${k.label}</div><div class="value">${k.value}</div><div class="delta ${k.cls}">${k.delta}</div></div>`
).join('');

// ═══════════════════════════════════════════════════════════════
// GA4 DAILY CHART — Sessions & Users
// ═══════════════════════════════════════════════════════════════
new Chart(document.getElementById('ga4DailyChart'),{
  type:'line',
  data:{
    labels: ga4.daily.map(d=>shortDay(d.date)+' '+dayLabel(d.date)),
    datasets:[
      {label:'Sessions',data:ga4.daily.map(d=>d.sessions),borderColor:'#6366f1',backgroundColor:'rgba(99,102,241,.1)',fill:true,tension:.3,pointRadius:3,pointBackgroundColor:'#6366f1'},
      {label:'Users',data:ga4.daily.map(d=>d.users),borderColor:'#a855f7',backgroundColor:'rgba(168,85,247,.05)',fill:true,tension:.3,pointRadius:3,pointBackgroundColor:'#a855f7',borderDash:[5,3]}
    ]
  },
  options:{responsive:true,maintainAspectRatio:true,aspectRatio:1.8,
    scales:{y:{beginAtZero:false,grid:{color:'rgba(255,255,255,.04)'}},x:{grid:{display:false}}},
    plugins:{tooltip:{callbacks:{label:ctx=>ctx.dataset.label+': '+fmt(ctx.parsed.y)}}}
  }
});

// GA4 Pageviews & Bounce
new Chart(document.getElementById('ga4PvBounceChart'),{
  type:'bar',
  data:{
    labels: ga4.daily.map(d=>shortDay(d.date)+' '+dayLabel(d.date)),
    datasets:[
      {label:'Pageviews',data:ga4.daily.map(d=>d.pageviews),backgroundColor:'rgba(6,182,212,.6)',borderRadius:4,yAxisID:'y'},
      {label:'Bounce Rate',data:ga4.daily.map(d=>(d.bounceRate*100).toFixed(1)),type:'line',borderColor:'#f59e0b',backgroundColor:'transparent',tension:.3,pointRadius:3,pointBackgroundColor:'#f59e0b',yAxisID:'y1'}
    ]
  },
  options:{responsive:true,maintainAspectRatio:true,aspectRatio:1.8,
    scales:{
      y:{beginAtZero:true,grid:{color:'rgba(255,255,255,.04)'},ticks:{callback:v=>fmt(v)}},
      y1:{position:'right',min:20,max:35,grid:{display:false},ticks:{callback:v=>v+'%'}},
      x:{grid:{display:false}}
    },
    plugins:{tooltip:{callbacks:{label:ctx=>ctx.dataset.label+': '+(ctx.datasetIndex===1?ctx.parsed.y+'%':fmt(ctx.parsed.y))}}}
  }
});

// ═══════════════════════════════════════════════════════════════
// TOP PAGES TABLE
// ═══════════════════════════════════════════════════════════════
const maxPv = ga4.topPages[0].pageviews;
const tpHtml = `<thead><tr><th>#</th><th>Page</th><th>Views</th><th></th><th>Sessions</th><th>Bounce</th><th>vs Last Wk</th></tr></thead><tbody>`+
  ga4.topPages.map((p,i)=>{
    const prev = ga4Prev.topPages.find(pp=>pp.pagePath===p.pagePath);
    const chg = prev?pctStr(p.pageviews,prev.pageviews):'new';
    const chgCls = prev?deltaClass(p.pageviews,prev.pageviews):'neutral';
    const name = p.pagePath==='/'?'Homepage':p.pagePath.split('/').pop().replace(/-/g,' ').replace(/\b\w/g,l=>l.toUpperCase());
    return `<tr>
      <td style="color:var(--muted)">${i+1}</td>
      <td><div style="font-weight:500;margin-bottom:2px">${name}</div><div class="page-path">${p.pagePath}</div></td>
      <td style="font-weight:600">${fmt(p.pageviews)}</td>
      <td style="width:80px"><div class="bar-bg"><div class="bar-fill blue" style="width:${(p.pageviews/maxPv*100).toFixed(0)}%"></div></div></td>
      <td>${fmt(p.sessions)}</td>
      <td>${(p.bounceRate*100).toFixed(1)}%</td>
      <td><span class="delta ${chgCls}">${chg}</span></td>
    </tr>`;
  }).join('')+'</tbody>';
document.getElementById('topPagesTable').innerHTML=tpHtml;

// ═══════════════════════════════════════════════════════════════
// SHOPIFY KPIs
// ═══════════════════════════════════════════════════════════════
const sKpis = [
  {label:'Revenue',value:fmtE(shopify.summary.totalRevenue),delta:pctStr(shopify.summary.totalRevenue,shopifyPrev.summary.totalRevenue),cls:deltaClass(shopify.summary.totalRevenue,shopifyPrev.summary.totalRevenue),c:'green'},
  {label:'Orders',value:shopify.summary.totalOrders,delta:pctStr(shopify.summary.totalOrders,shopifyPrev.summary.totalOrders),cls:deltaClass(shopify.summary.totalOrders,shopifyPrev.summary.totalOrders),c:'green'},
  {label:'AOV',value:fmtE(shopify.summary.averageOrderValue),delta:pctStr(shopify.summary.averageOrderValue,shopifyPrev.summary.averageOrderValue),cls:deltaClass(shopify.summary.averageOrderValue,shopifyPrev.summary.averageOrderValue),c:'cyan'},
  {label:'Conversion',value:(shopify.summary.totalOrders/ga4.overview.sessions*100).toFixed(2)+'%',delta:'vs '+(shopifyPrev.summary.totalOrders/ga4Prev.overview.sessions*100).toFixed(2)+'%',cls:'up',c:'purple'},
  {label:'Daily Revenue',value:fmtE(Math.round(shopify.summary.totalRevenue/8)),delta:'8-day avg',cls:'neutral',c:'green'},
  {label:'Paid Orders',value:shopify.summary.paidOrders,delta:'1 pending',cls:'neutral',c:'blue'},
];
document.getElementById('shopifyKpis').innerHTML = sKpis.map(k=>
  `<div class="kpi ${k.c}"><div class="label">${k.label}</div><div class="value">${k.value}</div><div class="delta ${k.cls}">${k.delta}</div></div>`
).join('');

// ═══════════════════════════════════════════════════════════════
// SHOPIFY REVENUE CHART
// ═══════════════════════════════════════════════════════════════
new Chart(document.getElementById('shopifyRevenueChart'),{
  type:'bar',
  data:{
    labels: shopify.revenueByDay.map(d=>shortDay(d.date)+' '+dayLabel(d.date)),
    datasets:[
      {label:'Revenue',data:shopify.revenueByDay.map(d=>d.revenue),backgroundColor:'rgba(34,197,94,.6)',borderRadius:4,yAxisID:'y'},
      {label:'Orders',data:shopify.revenueByDay.map(d=>d.orders),type:'line',borderColor:'#a855f7',backgroundColor:'transparent',tension:.3,pointRadius:4,pointBackgroundColor:'#a855f7',yAxisID:'y1'}
    ]
  },
  options:{responsive:true,maintainAspectRatio:true,aspectRatio:1.8,
    scales:{
      y:{beginAtZero:true,grid:{color:'rgba(255,255,255,.04)'},ticks:{callback:v=>'\u20AC'+fmt(v)}},
      y1:{position:'right',beginAtZero:true,grid:{display:false},ticks:{stepSize:1}},
      x:{grid:{display:false}}
    },
    plugins:{tooltip:{callbacks:{label:ctx=>ctx.dataset.label+': '+(ctx.datasetIndex===0?'\u20AC'+fmt(ctx.parsed.y):ctx.parsed.y)}}}
  }
});

// SHOPIFY COUNTRY CHART
const countryColors = ['#6366f1','#a855f7','#06b6d4','#22c55e','#f59e0b','#ef4444','#64748b'];
new Chart(document.getElementById('shopifyCountryChart'),{
  type:'doughnut',
  data:{
    labels: shopify.countries.map(c=>c.country),
    datasets:[{
      data: shopify.countries.map(c=>c.orders),
      backgroundColor: countryColors,
      borderWidth:0,
      hoverOffset:6
    }]
  },
  options:{responsive:true,maintainAspectRatio:true,aspectRatio:1.8,
    cutout:'65%',
    plugins:{
      legend:{position:'right',labels:{padding:8,font:{size:11}}},
      tooltip:{callbacks:{label:ctx=>ctx.label+': '+ctx.parsed+' orders ('+shopify.countries[ctx.dataIndex].share+'%)'}}
    }
  }
});

// ═══════════════════════════════════════════════════════════════
// TOP PRODUCTS TABLE
// ═══════════════════════════════════════════════════════════════
const maxRev = shopify.topProducts[0].revenue;
const prodHtml = `<thead><tr><th>#</th><th>Product</th><th>Units</th><th>Revenue</th><th></th></tr></thead><tbody>`+
  shopify.topProducts.map((p,i)=>`<tr>
    <td style="color:var(--muted)">${i+1}</td>
    <td style="font-weight:500">${p.product}</td>
    <td style="text-align:center">${p.units}</td>
    <td style="font-weight:600">${fmtE(p.revenue)}</td>
    <td style="width:100px"><div class="bar-bg"><div class="bar-fill green" style="width:${(p.revenue/maxRev*100).toFixed(0)}%"></div></div></td>
  </tr>`).join('')+'</tbody>';
document.getElementById('topProductsTable').innerHTML=prodHtml;

// ═══════════════════════════════════════════════════════════════
// GSC KPIs
// ═══════════════════════════════════════════════════════════════
const brandKw = gsc.keywords.filter(k=>k.keyword.includes('emisil'));
const brandClicks = brandKw.reduce((s,k)=>s+k.clicks,0);
const brandImpr = brandKw.reduce((s,k)=>s+k.impressions,0);
const gscKData = [
  {label:'Total Clicks',value:fmt(gsc.totals.clicks),delta:pctStr(gsc.totals.clicks,gscPrev.totals.clicks)+' *',cls:deltaClass(gsc.totals.clicks,gscPrev.totals.clicks),c:'orange'},
  {label:'Total Impressions',value:fmt(gsc.totals.impressions),delta:pctStr(gsc.totals.impressions,gscPrev.totals.impressions)+' *',cls:deltaClass(gsc.totals.impressions,gscPrev.totals.impressions),c:'orange'},
  {label:'Avg CTR',value:(gsc.totals.clicks/gsc.totals.impressions*100).toFixed(1)+'%',delta:'top 20 keywords',cls:'neutral',c:'cyan'},
  {label:'Brand Clicks',value:fmt(brandClicks),delta:'CTR '+(brandClicks/brandImpr*100).toFixed(0)+'%',cls:'up',c:'purple'},
];
document.getElementById('gscKpis').innerHTML = gscKData.map(k=>
  `<div class="kpi ${k.c}"><div class="label">${k.label}</div><div class="value">${k.value}</div><div class="delta ${k.cls}">${k.delta}</div></div>`
).join('') + '<div style="grid-column:1/-1;font-size:.7rem;color:var(--muted);padding:4px 0">* GSC data for recent 2-3 days is typically incomplete. Current-week numbers will rise as Google finalizes reporting.</div>';

// ═══════════════════════════════════════════════════════════════
// GSC KEYWORDS CHART (top 10 non-brand)
// ═══════════════════════════════════════════════════════════════
const nonBrand = gsc.keywords.filter(k=>!k.keyword.includes('emisil')).slice(0,10);
new Chart(document.getElementById('gscKeywordsChart'),{
  type:'bar',
  data:{
    labels: nonBrand.map(k=>k.keyword),
    datasets:[
      {label:'Clicks',data:nonBrand.map(k=>k.clicks),backgroundColor:'rgba(245,158,11,.7)',borderRadius:4,yAxisID:'y'},
      {label:'Impressions',data:nonBrand.map(k=>k.impressions),backgroundColor:'rgba(99,102,241,.4)',borderRadius:4,yAxisID:'y1'}
    ]
  },
  options:{responsive:true,maintainAspectRatio:true,aspectRatio:1.8,indexAxis:'y',
    scales:{
      y:{grid:{display:false},ticks:{font:{size:10}}},
      x:{grid:{color:'rgba(255,255,255,.04)'},position:'top'},
      y1:{display:false}
    },
    plugins:{legend:{position:'top'}}
  }
});

// GSC POSITION SCATTER
new Chart(document.getElementById('gscPositionChart'),{
  type:'bubble',
  data:{
    datasets:[{
      label:'Keywords',
      data: gsc.keywords.map(k=>({x:k.position,y:k.ctr,r:Math.max(3,Math.sqrt(k.impressions)/3),keyword:k.keyword,clicks:k.clicks,impressions:k.impressions})),
      backgroundColor: gsc.keywords.map(k=>k.keyword.includes('emisil')?'rgba(34,197,94,.6)':'rgba(99,102,241,.5)'),
      borderColor: gsc.keywords.map(k=>k.keyword.includes('emisil')?'#22c55e':'#6366f1'),
      borderWidth:1
    }]
  },
  options:{responsive:true,maintainAspectRatio:true,aspectRatio:1.8,
    scales:{
      x:{title:{display:true,text:'Position (lower is better)',color:'#8b8fa3'},reverse:false,grid:{color:'rgba(255,255,255,.04)'}},
      y:{title:{display:true,text:'CTR %',color:'#8b8fa3'},grid:{color:'rgba(255,255,255,.04)'}}
    },
    plugins:{
      legend:{display:false},
      tooltip:{callbacks:{
        title:ctx=>[],
        label:ctx=>{const d=ctx.raw;return [d.keyword,'Pos: '+d.x.toFixed(1)+' | CTR: '+d.y.toFixed(1)+'%','Clicks: '+d.clicks+' | Impr: '+fmt(d.impressions)];}
      }}
    }
  }
});

// ═══════════════════════════════════════════════════════════════
// GSC KEYWORDS TABLE
// ═══════════════════════════════════════════════════════════════
const gscHtml = `<thead><tr><th>#</th><th>Keyword</th><th>Clicks</th><th>Impressions</th><th>CTR</th><th>Position</th></tr></thead><tbody>`+
  gsc.keywords.map((k,i)=>{
    let posCls='pos-low';
    if(k.position<=1.5)posCls='pos-1';
    else if(k.position<=5)posCls='pos-top5';
    else if(k.position<=10)posCls='pos-top10';
    const isBrand=k.keyword.includes('emisil');
    return `<tr>
      <td style="color:var(--muted)">${i+1}</td>
      <td style="font-weight:${isBrand?'600':'400'};${isBrand?'color:#22c55e':''}">${k.keyword}</td>
      <td style="font-weight:600">${k.clicks}</td>
      <td>${fmt(k.impressions)}</td>
      <td>${k.ctr.toFixed(1)}%</td>
      <td><span class="pos-badge ${posCls}">${k.position.toFixed(1)}</span></td>
    </tr>`;
  }).join('')+'</tbody>';
document.getElementById('gscTable').innerHTML=gscHtml;

// ═══════════════════════════════════════════════════════════════
// SEO PERFORMANCE KPIs
// ═══════════════════════════════════════════════════════════════
const seoKpis = [
  {label:'Total Clicks',value:fmt(seo.current.clicks),delta:pctStr(seo.current.clicks,seo.previous.clicks),cls:deltaClass(seo.current.clicks,seo.previous.clicks),c:'purple'},
  {label:'Impressions',value:fmt(seo.current.impressions),delta:pctStr(seo.current.impressions,seo.previous.impressions),cls:deltaClass(seo.current.impressions,seo.previous.impressions),c:'blue'},
  {label:'Avg CTR',value:seo.current.ctr.toFixed(2)+'%',delta:((seo.current.ctr-seo.previous.ctr)>=0?'+':'')+((seo.current.ctr-seo.previous.ctr).toFixed(2))+'pp',cls:deltaClass(seo.current.ctr,seo.previous.ctr),c:'cyan'},
  {label:'Avg Position',value:seo.current.position.toFixed(1),delta:((seo.previous.position-seo.current.position)>=0?'+':'')+((seo.previous.position-seo.current.position).toFixed(2)),cls:deltaClass(seo.previous.position,seo.current.position),c:'orange'},
];
document.getElementById('seoKpis').innerHTML = seoKpis.map(k=>
  `<div class="kpi ${k.c}"><div class="label">${k.label}</div><div class="value">${k.value}</div><div class="delta ${k.cls}">${k.delta}</div></div>`
).join('') + '<div style="grid-column:1/-1;font-size:.7rem;color:var(--muted);padding:4px 0">30-day period: Jan 22 – Feb 20 vs Dec 23 – Jan 21. Clicks/impressions down partly due to incomplete recent GSC data.</div>';

// ═══════════════════════════════════════════════════════════════
// SEO BLOG POSTS TABLE
// ═══════════════════════════════════════════════════════════════
const maxBlogClicks = seo.topBlogPosts[0].clicks;
const blogHtml = `<thead><tr><th>#</th><th>Blog Post</th><th>Clicks</th><th></th><th>Impr</th><th>CTR</th><th>Pos</th><th>vs Prev</th></tr></thead><tbody>`+
  seo.topBlogPosts.map((p,i)=>{
    const slug = p.url.split('/').pop().replace(/-/g,' ');
    const name = slug.length>50 ? slug.slice(0,50)+'\u2026' : slug;
    const clickChg = pctStr(p.clicks,p.prevClicks);
    const clickCls = deltaClass(p.clicks,p.prevClicks);
    let posCls='pos-low';
    if(p.position<=1.5)posCls='pos-1';else if(p.position<=5)posCls='pos-top5';else if(p.position<=10)posCls='pos-top10';
    return `<tr>
      <td style="color:var(--muted)">${i+1}</td>
      <td><div style="font-weight:500;margin-bottom:2px;text-transform:capitalize">${name}</div><div class="page-path">${p.url}</div></td>
      <td style="font-weight:600">${fmt(p.clicks)}</td>
      <td style="width:80px"><div class="bar-bg"><div class="bar-fill purple" style="width:${(p.clicks/maxBlogClicks*100).toFixed(0)}%"></div></div></td>
      <td>${fmt(p.impressions)}</td>
      <td>${p.ctr.toFixed(1)}%</td>
      <td><span class="pos-badge ${posCls}">${p.position.toFixed(1)}</span></td>
      <td><span class="delta ${clickCls}">${clickChg}</span></td>
    </tr>`;
  }).join('')+'</tbody>';
document.getElementById('seoBlogTable').innerHTML=blogHtml;

// ═══════════════════════════════════════════════════════════════
// SEO QUERIES TABLE
// ═══════════════════════════════════════════════════════════════
const seoQHtml = `<thead><tr><th>#</th><th>Query</th><th>Clicks</th><th>Impressions</th><th>CTR</th><th>Position</th></tr></thead><tbody>`+
  seo.topQueries.map((k,i)=>{
    let posCls='pos-low';
    if(k.position<=1.5)posCls='pos-1';else if(k.position<=5)posCls='pos-top5';else if(k.position<=10)posCls='pos-top10';
    const isBrand=k.query.includes('emisil');
    return `<tr>
      <td style="color:var(--muted)">${i+1}</td>
      <td style="font-weight:${isBrand?'600':'400'};${isBrand?'color:#22c55e':''}">${k.query}</td>
      <td style="font-weight:600">${k.clicks}</td>
      <td>${fmt(k.impressions)}</td>
      <td>${k.ctr.toFixed(1)}%</td>
      <td><span class="pos-badge ${posCls}">${k.position.toFixed(1)}</span></td>
    </tr>`;
  }).join('')+'</tbody>';
document.getElementById('seoQueryTable').innerHTML=seoQHtml;

// ═══════════════════════════════════════════════════════════════
// POSITION CHANGE ALERTS
// ═══════════════════════════════════════════════════════════════
let alertsHtml = '';
alertsHtml += '<div style="margin-bottom:16px"><div style="font-size:.78rem;font-weight:600;color:var(--down);margin-bottom:8px;text-transform:uppercase;letter-spacing:.5px">\u25BC Dropped</div>';
seo.positionAlerts.dropped.forEach(p => {
  const name = p.page.split('/').pop().replace(/-/g,' ');
  alertsHtml += `<div style="display:flex;align-items:center;justify-content:space-between;padding:8px 10px;margin-bottom:4px;background:rgba(239,68,68,.06);border-radius:8px;border-left:3px solid var(--down)">
    <div style="min-width:0"><div style="font-size:.78rem;font-weight:500;text-transform:capitalize;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${name}</div><div class="page-path">${p.page}</div></div>
    <div style="text-align:right;flex-shrink:0;margin-left:12px"><span style="color:var(--down);font-weight:700;font-size:.85rem">${p.prevPos.toFixed(1)} \u2192 ${p.curPos.toFixed(1)}</span><div style="font-size:.7rem;color:var(--muted)">+${p.change.toFixed(1)} pos</div></div>
  </div>`;
});
alertsHtml += '</div>';
alertsHtml += '<div><div style="font-size:.78rem;font-weight:600;color:var(--up);margin-bottom:8px;text-transform:uppercase;letter-spacing:.5px">\u25B2 Improved</div>';
seo.positionAlerts.improved.forEach(p => {
  const name = p.page.split('/').pop().replace(/-/g,' ');
  alertsHtml += `<div style="display:flex;align-items:center;justify-content:space-between;padding:8px 10px;margin-bottom:4px;background:rgba(34,197,94,.06);border-radius:8px;border-left:3px solid var(--up)">
    <div style="min-width:0"><div style="font-size:.78rem;font-weight:500;text-transform:capitalize;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${name}</div><div class="page-path">${p.page}</div></div>
    <div style="text-align:right;flex-shrink:0;margin-left:12px"><span style="color:var(--up);font-weight:700;font-size:.85rem">${p.prevPos.toFixed(1)} \u2192 ${p.curPos.toFixed(1)}</span><div style="font-size:.7rem;color:var(--muted)">${p.change.toFixed(1)} pos</div></div>
  </div>`;
});
alertsHtml += '</div>';
document.getElementById('positionAlerts').innerHTML = alertsHtml;
</script>
</body>
</html>
